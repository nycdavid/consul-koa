version: "3"
services:
  consul-server-1:
    image: consul:1.0.3
    entrypoint:
      - consul
      - agent
      - -server
      - -data-dir=/tmp/consul
      - -bootstrap-expect=3

  consul-server-2:
    image: consul:1.0.3
    entrypoint:
      - consul
      - agent
      - -server
      - -data-dir=/tmp/consul
      - -bootstrap-expect=3
      - -retry-join
      - "consul-server-1"
  consul-server-3:
    image: consul:1.0.3
    entrypoint:
      - consul
      - agent
      - -server
      - -data-dir=/tmp/consul
      - -bootstrap-expect=3
      - -retry-join
      - "consul-server-1"
  consul-agent-1:
    image: consul:1.0.3
    entrypoint:
      - consul
      - agent
      - -config-dir=/etc/consul.d
      - -data-dir=/tmp/consul
      - -retry-join
      - "consul-server-1"
    volumes:
      - "./etc/consul.d:/etc/consul.d"
  consul-ui:
    image: consul:1.0.3
    ports:
      - "8300:8300"
      - "8301:8301"
      - "8302:8302"
      - "8500:8500"
      - "8600:8600"
    entrypoint:
      - consul
      - agent
      - -ui
      - -client=0.0.0.0
      - -data-dir=/tmp/consul
      - -retry-join
      - "consul-server-1"
